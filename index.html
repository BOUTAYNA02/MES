<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>SMART SCHEDULING SIMULATOR</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<script src="{{ url_for('static', filename='js/animations.js') }}" defer></script>
</head>

<body>

<header class="hero">
    <h1>SMART SCHEDULING SIMULATOR</h1>
    <p>Ordonnancement intelligent â€¢ FlowShop & JobShop</p>
</header>

<div class="container">

<!-- ===== Ã‰TAPE 1 : Choisir le type dâ€™atelier ===== -->
{% if step == 1 %}
<form method="post" class="card fade-in">
    <input type="hidden" name="step" value="2">
    <label>Type dâ€™atelier :</label>
    <select name="shop_type" required>
        <option value="">-- Choisir --</option>
        <option value="FlowShop">FlowShop</option>
        <option value="JobShop">JobShop</option>
    </select>
    <button>Valider</button>
</form>
{% endif %}

<!-- ===== Ã‰TAPE 2 : Choisir la mÃ©thode et le nombre de jobs/machines ===== -->
{% if step == 2 %}
<form method="post" class="card slide-in">
    <input type="hidden" name="step" value="3">
    <input type="hidden" name="shop_type" value="{{ shop_type }}">

    <label>MÃ©thode :</label>
    <select name="method" required>
        <option>FIFO</option>
        <option>SPT</option>
        <option>LPT</option>
        <option>EDD</option>
        <option>WDD</option>
        {% if shop_type == 'FlowShop' %}
        <option>Johnson</option>
        <option>CDS</option>
        {% endif %}
    </select>

    <label>Nombre de jobs :</label>
    <input type="number" name="n_jobs" min="1" required>

    <label>Nombre de machines :</label>
    <input type="number" name="n_machines" min="1" required>

    <button>Suivant</button>
</form>
{% endif %}

<!-- ===== Ã‰TAPE 3 : Remplir tableau des jobs ===== -->
{% if step == 3 %}
<form method="post" class="card zoom-in">
    <input type="hidden" name="step" value="4">
    <input type="hidden" name="shop_type" value="{{ shop_type }}">
    <input type="hidden" name="method" value="{{ method }}">
    <input type="hidden" name="n_jobs" value="{{ n_jobs }}">
    <input type="hidden" name="n_machines" value="{{ n_machines }}">

    <table>
        <tr>
            <th>Job</th>
            <th>ArrivÃ©e</th>
            <th>DurÃ©e</th>
            <th>DÃ©lai</th>
            <th>Poids</th>
        </tr>
        {% for i in range(n_jobs) %}
        <tr>
            <td>J{{ i+1 }}</td>
            <td><input type="number" name="arrival_{{ i }}" required></td>
            <td><input type="number" name="duration_{{ i }}" required></td>
            <td><input type="number" name="due_{{ i }}" required></td>
            <td><input type="number" name="weight_{{ i }}" required></td>
        </tr>
        {% endfor %}
    </table>

    <button>Lancer la simulation ðŸš€</button>
</form>
{% endif %}

<!-- ===== Ã‰TAPE 4 : RÃ©sultats ===== -->
{% if results %}
<div class="card results pop">
    <h2>ðŸ“Š Indicateurs</h2>
    <ul>
        <li><strong>Cmax :</strong> {{ results.cmax }}</li>
        <li><strong>TFT :</strong> {{ results.tft }}</li>
        <li><strong>TT :</strong> {{ results.tt }}</li>
        <li><strong>TAR :</strong> {{ results.tar }}</li>
        <li><strong>TFR :</strong> {{ results.tfr }}</li>
    </ul>

    <h2>ðŸ§© Diagramme de Gantt</h2>
    {% for g in gantt %}
    <div class="gantt">
        <span>Machine {{ g.machine }}</span>
        <div class="bar" data-duration="{{ g.duration }}">
            {{ g.job }} ({{ g.start }} â†’ {{ g.end }})
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

</div>
</body>
</html>
